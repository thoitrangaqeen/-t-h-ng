<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form ƒê·∫∑t H√†ng</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
        <h1 class="text-2xl font-bold text-center mb-6">Form ƒê·∫∑t H√†ng</h1>
        <form id="orderForm" class="space-y-4">
            <!-- S·∫£n ph·∫©m -->
            <div>
                <label class="block text-sm font-medium text-gray-700">S·∫£n ph·∫©m</label>
                <select id="product" name="product" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required>
                    <option value="" disabled selected>Ch·ªçn s·∫£n ph·∫©m</option>
                    <!-- C√°c option s·∫Ω ƒë∆∞·ª£c th√™m b·ªüi JavaScript -->
                </select>
            </div>

            <!-- Size -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Size</label>
                <select id="size" name="size" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required>
                    <option value="" disabled selected>Ch·ªçn size</option>
                    <option value="S">S</option>
                    <option value="M">M</option>
                    <option value="L">L</option>
                    <option value="XL">XL</option>
                    <option value="XXL">XXL</option>
                </select>
            </div>

            <!-- S·ªë l∆∞·ª£ng -->
            <div>
                <label class="block text-sm font-medium text-gray-700">S·ªë l∆∞·ª£ng</label>
                <input type="number" id="quantity" name="quantity" min="1" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required>
            </div>

            <!-- T√™n kh√°ch -->
            <div>
                <label class="block text-sm font-medium text-gray-700">T√™n kh√°ch</label>
                <input type="text" id="customername" name="customername" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required>
            </div>

            <!-- SƒêT -->
            <div>
                <label class="block text-sm font-medium text-gray-700">S·ªë ƒëi·ªán tho·∫°i</label>
                <input type="tel" id="phone" name="phone" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required>
            </div>

            <!-- ƒê·ªãa ch·ªâ -->
            <div>
                <label class="block text-sm font-medium text-gray-700">ƒê·ªãa ch·ªâ</label>
                <input type="text" id="address" name="address" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required>
            </div>

            <!-- Ghi ch√∫ -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Ghi ch√∫</label>
                <textarea id="notes" name="notes" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" rows="4"></textarea>
            </div>

            <!-- T·ªïng ti·ªÅn -->
            <div>
                <label class="block text-sm font-medium text-gray-700">T·ªïng ti·ªÅn</label>
                <input type="text" id="totalprice" name="totalprice" class="mt-1 block w-full p-2 border border-gray-300 rounded-md bg-gray-100" readonly>
            </div>

            <!-- N√∫t g·ª≠i -->
            <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700">G·ª≠i ƒê∆°n H√†ng</button>
        </form>
    </div>

    <script>
        // Thay b·∫±ng Web App URL c·ªßa b·∫°n
        const scriptURL = 'https://script.google.com/macros/s/AKfycbyGo-pWiqP0L8bQC4qHmfdJBM8fYQuWfoWfPgklOUjNWkk23KIn42zFYF7nwI9qn6id-A/exec';
        // Telegram Bot API
        const telegramBotToken = '7626564277:AAHamCcfY86-jhqBukZW9wKXKuzWBXEo5jo';
        const telegramChatId = '7561438631';

        // Danh s√°ch s·∫£n ph·∫©m v√† gi√° (x√≥a d·∫•u ph·∫©y th·ª´a)
        const products = [
            { name: "Qu·∫ßn ·ªëng r·ªông", price: 139000 },
            { name: "√Åo s∆° mi ch·∫•m bi", price: 189000 },
            { name: "SET v√†ng tr·∫Øng", price: 229000 },
            { name: "SET c·ªôc", price: 239000 }
        ];

        // Th√™m s·∫£n ph·∫©m v√†o select
        const productSelect = document.getElementById("product");
        products.forEach(product => {
            const option = document.createElement("option");
            option.value = product.name;
            option.textContent = `${product.name} - ${product.price.toLocaleString("vi-VN")} VND`;
            option.dataset.price = product.price;
            productSelect.appendChild(option);
        });

        // T√≠nh t·ªïng ti·ªÅn
        function calculateTotal() {
            const product = productSelect.options[productSelect.selectedIndex];
            const quantity = parseInt(document.getElementById("quantity").value) || 0;
            const price = product ? parseInt(product.dataset.price) : 0;
            const total = price * quantity;
            document.getElementById("totalprice").value = total.toLocaleString("vi-VN") + " VND";
        }

        // G·ªçi h√†m t√≠nh t·ªïng ti·ªÅn khi thay ƒë·ªïi s·∫£n ph·∫©m ho·∫∑c s·ªë l∆∞·ª£ng
        productSelect.addEventListener("change", calculateTotal);
        document.getElementById("quantity").addEventListener("input", calculateTotal);

        // X·ª≠ l√Ω g·ª≠i form
        document.getElementById("orderForm").addEventListener("submit", function (e) {
            e.preventDefault();
            
            const form = document.getElementById("orderForm");
            const formData = new FormData(form);
            const formObject = Object.fromEntries(formData);

            // G·ª≠i d·ªØ li·ªáu ƒë·∫øn Google Sheets
            fetch(scriptURL, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('L·ªói khi g·ª≠i ƒë·∫øn Google Sheets: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                if (data.result === 'success') {
                    // G·ª≠i th√¥ng b√°o qua Telegram
                    const message = `
üì¶ *ƒê∆°n h√†ng m·ªõi* üì¶
- *S·∫£n ph·∫©m*: ${formObject.product}
- *Size*: ${formObject.size}
- *S·ªë l∆∞·ª£ng*: ${formObject.quantity}
- *T√™n kh√°ch*: ${formObject.customername}
- *SƒêT*: ${formObject.phone}
- *ƒê·ªãa ch·ªâ*: ${formObject.address}
- *Ghi ch√∫*: ${formObject.notes || 'Kh√¥ng c√≥'}
- *T·ªïng ti·ªÅn*: ${formObject.totalprice}
- *Th·ªùi gian*: ${new Date().toLocaleString('vi-VN')}
                    `;
                    const telegramUrl = `https://api.telegram.org/bot${telegramBotToken}/sendMessage`;
                    return fetch(telegramUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: telegramChatId,
                            text: message,
                            parse_mode: 'Markdown'
                        })
                    });
                } else {
                    throw new Error('L·ªói t·ª´ Google Sheets: ' + data.error);
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('L·ªói khi g·ª≠i Telegram: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                if (data.ok) {
                    alert("ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c g·ª≠i, l∆∞u v√†o Google Sheets v√† th√¥ng b√°o qua Telegram!");
                    form.reset();
                    document.getElementById("totalprice").value = "";
                } else {
                    throw new Error('L·ªói g·ª≠i th√¥ng b√°o Telegram: ' + data.description);
                }
            })
            .catch(error => {
                console.error('L·ªói:', error);
                alert("L·ªói: " + error.message);
            });
        });
    </script>
</body>
</html>